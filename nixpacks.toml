# Railway Nixpacks configuration
# Fix DATABASE_URL to use asyncpg driver for async SQLAlchemy

[phases.setup]
nixPkgs = ["python311", "postgresql"]

[start]
# Transform DATABASE_URL from postgresql:// to postgresql+asyncpg://
cmd = "sh -c 'export DATABASE_URL=$(echo $DATABASE_URL | sed \"s/postgresql:\\/\\//postgresql+asyncpg:\\/\\//\") && alembic upgrade head && uvicorn app.main:app --host 0.0.0.0 --port $PORT'"
